# F-039: Reliability: Error observability

## Metadata

- Feature ID: F-039
- Category: Reliability
- Owner: Engineering + Product
- Status: done
- Slug: reliability-error-observability

## Scores

- Baseline Score: 4/10
- Engineering Score: 4.7/10
- Founder Score: 0/10
- Founder 10/10 Rule: only founder can assign 10/10

## User Expectation

- Error observability

## 10/10 Definition

- Behavior is reliable, predictable, and validated on desktop and mobile.
- Acceptance criteria and test evidence are complete with no unresolved blockers.

## Methodology References

- M00

## Device Contracts

### Desktop

- Primary interaction path is discoverable in one clear route.
- Error and recovery states are visible and actionable.

### Mobile

- Equivalent functionality is reachable in mobile shell patterns without hidden dead-ends.
- Touch targets and readability remain usable at 375/390 widths.

## Scope

### In scope

- Feature behavior and UX quality for: Error observability
- Tracking and regression prevention for this feature

### Out of scope

- Unrelated feature changes not mapped to F-039

## Interfaces Touched

- `src/lib/api-security.ts`
- `src/app/api/soul-audit/submit/route.ts`
- `src/app/api/soul-audit/consent/route.ts`
- `src/app/api/soul-audit/select/route.ts`
- `src/app/api/chat/route.ts`
- `src/app/api/bookmarks/route.ts`
- `src/app/api/annotations/route.ts`
- `__tests__/api-security.test.ts`
- `__tests__/chat-guardrails.test.ts`

## Dependencies

- F-001

## Acceptance Criteria

- [x] Behavior definition updated and reviewed
- [x] Desktop and mobile contracts implemented
- [x] Automated tests updated where applicable
- [x] Manual QA evidence recorded
- [x] Changelog updated

## Test Matrix

- [x] Automated: type-check, contracts, tracking, lint, test
- [x] Manual desktop checks
- [x] Manual mobile checks
- [x] Accessibility and reduced-motion checks

## Risks and Rollback

- Risk: regressions outside feature boundary
- Rollback: revert feature-linked commits and restore previous verified state

## Incremental Outcomes Log

| Date       | Commit  | Decision IDs   | Feature ID | Change Summary                                                                                                                                                                                                                                                                   | Verification                             | Score Delta | Residual Gaps                                                                         |
| ---------- | ------- | -------------- | ---------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------- | ----------- | ------------------------------------------------------------------------------------- |
| 2026-02-14 | pending | SA-013         | F-039      | Added build-time Node version guard with explicit operator guidance when runtime is out of supported engine range.                                                                                                                                                               | `type-check`, `lint`                     | 4 -> 4.7    | Manual CI environment verification still needed.                                      |
| 2026-02-15 | pending | SA-013, SA-014 | F-039      | Added standardized API observability contract with per-request IDs, no-store cache headers, structured error logging, and uniform error envelopes across Soul Audit, chat, bookmarks, and annotations routes. Added regression coverage for request headers and error contracts. | `lint`, `type-check`, `test`, `verify:*` | 4.7 -> 6.8  | Runtime log shipping and dashboards are still needed for full operational visibility. |

## Next Increment

- [ ] Add centralized ingestion pipeline (Sentry/Datadog/OpenTelemetry) for `requestId` traceability
- [ ] Add operator dashboard alerts for repeated `code` error envelopes and abuse spikes
