# F-060: Soul Audit Pipeline Overhaul

**Status:** Implemented
**Priority:** Critical (submit wait time reduced from 30-60s to < 1s)

---

## Problem

The Soul Audit pipeline had a 30-60 second submit wait (LLM generating 3 plan outlines from scratch), a client-driven cascade that required the browser tab to stay open, a 2,775-line results page monolith, a separate consent endpoint, duplicate submit logic across 3 pages, and disabled day gating.

## Solution

### Phase 1: Instant Ingredient Selection

- Replace LLM outline generation with deterministic keyword scoring of existing 167 curated module candidates (< 1 second)
- New `ingredient-selector.ts` scores and ranks candidates
- New `composer.ts` handles focused single-day LLM composition (5-8s per day)
- Delete: `outline-generator.ts`, `outline-cache.ts`, `generative-builder.ts`, `generate-next` route, `generation-status` route, `useGenerationStatus` hook

### Phase 2: Unified Entry Points and Inline Consent

- New `useSoulAuditSubmit` shared hook replaces duplicate submit logic in homepage and /soul-audit page
- Consent folded into select route (`essentialAccepted` in request body) â€” delete separate consent route
- Results page decomposed from 2,775 lines into focused components: `OptionCard`, `CrisisGate`, `DayContent`, `helpers.ts`
- Plan reader moved to dedicated page at `/soul-audit/plan/[planToken]`

### Phase 3: Day Gating Re-enabled

- Default `dayLockingEnabled` changed from `false` to `true`
- Days unlock at 7 AM local time per the Monday cycle (existing `schedule.ts` logic)

### Phase 4: Route Consolidation

- Delete unused `Navigation.tsx`, deprecated bridge route, consent route
- Update production contracts and test suites

## Files Changed

**New files:** `src/lib/soul-audit/composer.ts`, `src/lib/soul-audit/ingredient-selector.ts`, `src/hooks/useSoulAuditSubmit.ts`, `src/components/soul-audit/{helpers,CrisisGate,OptionCard,DayContent}.ts(x)`

**Deleted files:** `outline-generator.ts`, `outline-cache.ts`, `generative-builder.ts`, `generate-next/route.ts`, `generation-status/route.ts`, `useGenerationStatus.ts`, `consent/route.ts`, `route.ts` (bridge), `Navigation.tsx`

**Net change:** -3,800 lines

## Verification

- 1039 tests passing
- Zero type errors in src/
- Production contracts updated and passing
- Composer uses reference library chunks (Augustine, commentaries, theology) not raw module text
- All 7 days composed at selection time (no pending stubs)
