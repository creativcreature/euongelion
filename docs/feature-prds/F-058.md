# F-058: Fix Select Timeout â€” Async Day Generation

**Status:** Implemented
**Priority:** Critical (selection was timing out on Vercel, showing error to users)

---

## Problem

When a user selected an `ai_generative` devotional option, the `/api/soul-audit/select` endpoint tried to generate Day 1's full content synchronously via an LLM call (claude-sonnet-4-6). This call:

1. Required 15-30 seconds of LLM processing
2. Hit Vercel's function execution timeout
3. Returned: "Unable to generate your first devotional day right now. Please try again or choose another option."
4. Made the entire Soul Audit flow unusable for generative paths

Combined with the ~20s outline generation at submit time, users waited up to 2 minutes only to receive an error.

## Root Cause

`select/route.ts` line 412-431 called `generateDevotionalDay()` synchronously during the HTTP selection request. This LLM call (reference retrieval + Claude API generation + JSON parsing) exceeded Vercel's serverless function timeout.

## Fix

Removed the synchronous Day 1 generation from the selection endpoint. All 7 days now start with `generationStatus: 'pending'` and the selection returns immediately. The existing cascade generator (`/api/soul-audit/generate-next`) handles all day generation progressively after the user lands on the plan page.

This means:

- Selection completes in <500ms (no LLM call)
- Day 1 generates via cascade within ~15-20s of page load
- Days 2-7 generate progressively after Day 1 completes
- Each day uses real RAG references from `reference-index.json` (F-057)

## Files Changed

- `src/app/api/soul-audit/select/route.ts` (removed sync Day 1 generation)
- `docs/feature-prds/F-058.md` (this file)

## Verification

- TypeScript type-check passes for `select/route.ts`
- No behavior change for `curated_prefab` or `ai_primary` paths
- Cascade generation (`generate-next`) already handles pending days correctly
