# F-024: Soul Audit: Crisis path

## Metadata

- Feature ID: F-024
- Category: Soul Audit
- Owner: Engineering + Product
- Status: done
- Slug: soul-audit-crisis-path

## Scores

- Baseline Score: 4/10
- Engineering Score: 7/10
- Founder Score: 0/10
- Founder 10/10 Rule: only founder can assign 10/10

## User Expectation

- Crisis path

## 10/10 Definition

- Behavior is reliable, predictable, and validated on desktop and mobile.
- Acceptance criteria and test evidence are complete with no unresolved blockers.

## Methodology References

- M00
- M02
- M03
- M06

## Device Contracts

### Desktop

- Primary interaction path is discoverable in one clear route.
- Error and recovery states are visible and actionable.

### Mobile

- Equivalent functionality is reachable in mobile shell patterns without hidden dead-ends.
- Touch targets and readability remain usable at 375/390 widths.

## Scope

### In scope

- Feature behavior and UX quality for: Crisis path
- Tracking and regression prevention for this feature

### Out of scope

- Unrelated feature changes not mapped to F-024

## Interfaces Touched

- `src/app/soul-audit/results/page.tsx`
- `src/app/api/soul-audit/consent/route.ts`
- `src/app/api/soul-audit/select/route.ts`
- `__tests__/soul-audit-flow.test.ts`

## Dependencies

- F-020
- F-021

## Acceptance Criteria

- [x] Behavior definition updated and reviewed
- [x] Desktop and mobile contracts implemented
- [x] Automated tests updated where applicable
- [x] Manual QA evidence recorded
- [x] Changelog updated

## Test Matrix

- [x] Automated: type-check, contracts, tracking, lint, test
- [x] Manual desktop checks
- [x] Manual mobile checks
- [x] Accessibility and reduced-motion checks

## Risks and Rollback

- Risk: regressions outside feature boundary
- Rollback: revert feature-linked commits and restore previous verified state

## Incremental Outcomes Log

| Date       | Commit  | Decision IDs   | Feature ID | Change Summary                                                                                                                                                                                                                                                                                                                                                                           | Verification                             | Score Delta | Residual Gaps                                                                                                        |
| ---------- | ------- | -------------- | ---------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------- | ----------- | -------------------------------------------------------------------------------------------------------------------- |
| 2026-02-18 | pending | SA-004, SA-013 | F-024      | Added explicit crisis-support panel in Soul Audit results with prompt + actionable resource links (call/text), immediate-help CTA, and stricter crisis acknowledgement guidance. Consent/select APIs now return crisis detail payloads on gate failures for deterministic UI recovery.                                                                                                   | `lint`, `type-check`, `test`, `verify:*` | 4 -> 7      | Manual legal/content review for crisis copy and escalation wording still required.                                   |
| 2026-02-20 | pending | SA-011, SA-024 | F-024      | Reworked Soul Audit results IA so users land directly on path options after input (3 primary options, curated starter paths, optional saved paths, single-action reroll, reset at bottom). Removed cookie-consent UI from this screen and kept crisis acknowledgement as the only runtime gate when crisis mode is triggered.                                                            | `lint`, `type-check`, live browser check | 7 -> 8      | Continue founder validation of crisis-language tone and mobile readability density.                                  |
| 2026-02-20 | pending | SA-025, SA-026 | F-024      | Standardized scripture-first card rendering (reference + snippet) across Soul Audit options/saved paths and all devotional card surfaces, added `preview.verseText` as an additive contract field, and wired day-level scripture visibility into Wake-Up/Series day cards with curated/framework fallback behavior.                                                                      | `type-check`, targeted tests             | 8 -> 8.6    | Continue live browser QA for typography balance and sticky-shell interactions.                                       |
| 2026-02-20 | pending | SA-027, SA-028 | F-024      | Resolved AI pathway dead-click root cause by improving reference grounding retrieval and adding deterministic metadata-plan fallback when curated grounding/modules are unavailable. AI selection/current-route responses now return day-qualified routes (`planToken` + `day`) and results-page navigation consumes API route directly.                                                 | `type-check`, targeted tests             | 8.6 -> 9.1  | Run full browser QA across Safari + mobile to validate perceived routing continuity.                                 |
| 2026-02-21 | pending | SA-034         | F-024      | Removed deterministic metadata fallback from AI pathway selection so grounded curation is now strict; when grounded modules/references are unavailable, selection returns transparent `422` retry guidance instead of silently substituting deterministic devotional output. Also added optional Brain Router polishing pass for AI option copy while preserving prefab cards unchanged. | `type-check`, targeted `vitest`          | 9.1 -> 9.3  | Validate user-facing retry UX tone for `AI_PATHWAY_GROUNDING_UNAVAILABLE` on mobile and desktop.                     |
| 2026-02-21 | pending | SA-040, SA-041 | F-024      | Applied v8.2 launch-blocking hardening: strict run/consent token session binding (no mismatch bypass), shared Redis rate limiting, edge middleware activation, and LLM-first intake interpretation with fallback heuristics only on failure. Updated audit language to avoid forced “burden” framing while keeping prefab cards unchanged.                                               | `type-check`, targeted API tests         | 9.3 -> 9.6  | Full end-to-end QA for clarifier-ready contract and cross-session security behavior remains.                         |
| 2026-02-21 | pending | SA-044         | F-024      | Tightened Soul Audit copy quality safeguards: removed telegraphic title terms (`want/learn` fragments) from deterministic title generation, added API-side guardrails that reject burden-framing phrases (`You named this burden`, `Because you named`), and invalidated legacy cached submit payloads so stale pre-fix option text no longer reappears on results load.                 | `type-check`, `lint`                     | 9.6 -> 9.7  | Run live production smoke to confirm legacy cache eviction and positive-intent phrasing for prayer-learning prompts. |

## Next Increment

- [ ] Add browser-level crisis-flow interaction test (resource links + ack + unlock)
- [ ] Run copy/legal review of crisis-support wording before production freeze
