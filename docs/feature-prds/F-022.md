# F-022: Soul Audit: Selection locking

## Metadata

- Feature ID: F-022
- Category: Soul Audit
- Owner: Engineering + Product
- Status: in-progress
- Slug: soul-audit-selection-locking

## Scores

- Baseline Score: 5/10
- Engineering Score: 8.4/10
- Founder Score: 0/10
- Founder 10/10 Rule: only founder can assign 10/10

## User Expectation

- Selection locking

## 10/10 Definition

- Behavior is reliable, predictable, and validated on desktop and mobile.
- Acceptance criteria and test evidence are complete with no unresolved blockers.

## Methodology References

- M00
- M02
- M03
- M06

## Device Contracts

### Desktop

- Primary interaction path is discoverable in one clear route.
- Error and recovery states are visible and actionable.

### Mobile

- Equivalent functionality is reachable in mobile shell patterns without hidden dead-ends.
- Touch targets and readability remain usable at 375/390 widths.

## Scope

### In scope

- Feature behavior and UX quality for: Selection locking
- Tracking and regression prevention for this feature

### Out of scope

- Unrelated feature changes not mapped to F-022

## Interfaces Touched

- `src/app/page.tsx`
- `src/app/soul-audit/results/page.tsx`
- `src/app/api/soul-audit/submit/route.ts`
- `__tests__/soul-audit-flow.test.ts`
- `__tests__/soul-audit-edge-cases.test.ts`

## Dependencies

- F-019
- F-021
- F-023

## Acceptance Criteria

- [x] Behavior definition updated and reviewed
- [x] Desktop and mobile contracts implemented
- [x] Automated tests updated where applicable
- [ ] Manual QA evidence recorded
- [x] Changelog updated

## Test Matrix

- [x] Automated: type-check, contracts, tracking, lint, test
- [ ] Manual desktop checks
- [ ] Manual mobile checks
- [ ] Accessibility and reduced-motion checks

## Risks and Rollback

- Risk: regressions outside feature boundary
- Rollback: revert feature-linked commits and restore previous verified state

## Incremental Outcomes Log

| Date       | Commit  | Decision IDs   | Feature ID | Change Summary                                                                                                                                                                                                                                                                                                        | Verification                             | Score Delta | Residual Gaps                                                                 |
| ---------- | ------- | -------------- | ---------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------- | ----------- | ----------------------------------------------------------------------------- |
| 2026-02-15 | pending | SA-013, SA-014 | F-022      | Added session-backed audit input persistence and run-expiration recovery flow on results page (`Reload Options`) so stale run IDs no longer force a full restart when user input is still available. Also aligned reroll to the same persisted input source for post-refresh reliability.                             | `lint`, `type-check`, `test`, `verify:*` | 5 -> 7.1    | Manual multi-tab/session churn QA still needed across mobile and desktop.     |
| 2026-02-15 | pending | SA-013, SA-014 | F-022      | Added explicit run-recovery contract tests to lock session-backed input persistence and expired-run reload affordance across homepage submit/reset and results flows.                                                                                                                                                 | `lint`, `type-check`, `test`, `verify:*` | 7.1 -> 7.4  | Browser E2E for expired-run recovery still pending (typed flow + limit edge). |
| 2026-02-18 | pending | SA-013, SA-014 | F-022      | Hardened selection/reroll locking by rejecting reroll attempts that change original audit response text (`REROLL_RESPONSE_MISMATCH`), added richer required-action details in consent/selection gate responses, and tightened result-side selection unlock to consent-recorded state rather than checkbox-only state. | `lint`, `type-check`, `test`, `verify:*` | 7.4 -> 8.0  | Browser E2E for run-expired recovery + consent re-record flow still pending.  |
| 2026-02-18 | pending | SA-013, SA-014 | F-022      | Added automatic expired-run recovery attempt during consent/select failures (`RUN_NOT_FOUND`) so users get reloaded options instead of dead-end errors mid-selection.                                                                                                                                                 | `lint`, `type-check`, `test`, `verify:*` | 8.0 -> 8.4  | Manual multi-tab churn QA still needed on mobile Safari and desktop Chrome.   |

## Next Increment

- [ ] Add browser-level integration test coverage for run-expired recovery + consent re-record flow
- [ ] Validate one-reroll policy with end-to-end telemetry in production-like session churn
