@import 'tailwindcss';
@import '../../design-system/typography-craft.css';

@font-face {
  font-family: 'Instrument Serif';
  src:
    url('/fonts/InstrumentSerif-Regular.woff2') format('woff2'),
    url('/fonts/InstrumentSerif-Regular.ttf') format('truetype');
  font-style: normal;
  font-weight: 400;
  font-display: block;
}

@font-face {
  font-family: 'Industry';
  src: url('/fonts/IndustryTest-Book.otf') format('opentype');
  font-style: normal;
  font-weight: 400;
  font-display: swap;
}

@font-face {
  font-family: 'Industry';
  src: url('/fonts/IndustryTest-Demi.otf') format('opentype');
  font-style: normal;
  font-weight: 600;
  font-display: swap;
}

@font-face {
  font-family: 'Industry';
  src: url('/fonts/IndustryTest-Bold.otf') format('opentype');
  font-style: normal;
  font-weight: 700;
  font-display: swap;
}

@font-face {
  font-family: 'Instrument Serif';
  src:
    url('/fonts/InstrumentSerif-Italic.woff2') format('woff2'),
    url('/fonts/InstrumentSerif-Italic.ttf') format('truetype');
  font-style: italic;
  font-weight: 400;
  font-display: block;
}

@theme {
  /* ============================================
     COLOR TOKENS — The Bold Three (Foundation)
     ============================================ */
  --color-tehom: #0f1b2e;
  --color-scroll: #fff8ec;
  --color-gold: #1f4f82;

  /* Theological Accents (rare, intentional use) */
  --color-burgundy: #8e3f3f;
  --color-olive: #6f8f4f;
  --color-shalom: #4d9fb0;

  /* RGB channels for rgba() usage */
  --color-tehom-rgb: 15, 27, 46;
  --color-scroll-rgb: 255, 248, 236;
  --color-gold-rgb: 31, 79, 130;

  /* ============================================
     SEMANTIC COLOR TOKENS (Dark mode default)
     ============================================ */
  --color-bg: var(--color-tehom);
  --color-fg: var(--color-scroll);
  --color-accent: var(--color-gold);

  /* Text hierarchy */
  --color-text-primary: var(--color-scroll);
  --color-text-secondary: rgba(247, 243, 237, 0.7);
  --color-text-tertiary: rgba(247, 243, 237, 0.5);
  --color-text-muted: rgba(247, 243, 237, 0.4);

  /* UI elements */
  --color-border: rgba(247, 243, 237, 0.1);
  --color-border-strong: rgba(247, 243, 237, 0.2);
  --color-surface: rgba(247, 243, 237, 0.05);
  --color-surface-raised: rgba(247, 243, 237, 0.08);
  --color-overlay: rgba(26, 22, 18, 0.8);

  /* Interactive states */
  --color-hover: rgba(247, 243, 237, 0.1);
  --color-active: rgba(247, 243, 237, 0.15);
  --color-focus-ring: rgba(31, 79, 130, 0.36);

  /* Feedback colors */
  --color-success: #5fa067;
  --color-warning: #b38345;
  --color-error: #b04b4b;
  --color-info: #4d9fb0;

  /* Typography: letter spacing only (font-family on :root below — @theme can't use var() refs to runtime variables) */

  /* Letter spacing tokens */
  --tracking-tight: -0.02em;
  --tracking-normal: 0;
  --tracking-wide: 0.05em;
  --tracking-wider: 0.1em;
  --tracking-widest: 0.2em;

  /* ============================================
     SPACING TOKENS (4px base)
     ============================================ */
  --space-xs: 8px;
  --space-sm: 16px;
  --space-md: 24px;
  --space-lg: 40px;
  --space-xl: 60px;
  --space-2xl: 80px;
  --space-3xl: 120px;

  /* Max widths */
  --max-w-reading: 680px;
  --max-w-content: 800px;
  --max-w-display: 1200px;
  --max-w-full: 1440px;

  /* Touch targets */
  --touch-min: 44px;

  /* ============================================
     BORDER RADIUS
     ============================================ */
  --radius-sm: 2px;
  --radius-md: 4px;
  --radius-lg: 8px;
  --radius-xl: 12px;

  /* ============================================
     SHADOWS (warm-tinted from Tehom)
     ============================================ */
  --shadow-sm: 0 2px 4px rgba(15, 27, 46, 0.14);
  --shadow-md: 0 4px 8px rgba(15, 27, 46, 0.18);
  --shadow-lg: 0 8px 16px rgba(15, 27, 46, 0.24);
  --shadow-xl: 0 16px 32px rgba(15, 27, 46, 0.3);
  --shadow-focus: 0 0 0 3px rgba(31, 79, 130, 0.4);

  /* ============================================
     TRANSITION TOKENS
     ============================================ */
  --ease-out: cubic-bezier(0, 0, 0.2, 1);
  --ease-in: cubic-bezier(0.4, 0, 1, 1);
  --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
  --ease-bounce: cubic-bezier(0.16, 1, 0.3, 1);

  --duration-fast: 150ms;
  --duration-base: 200ms;
  --duration-moderate: 300ms;
  --duration-slow: 400ms;
  --duration-slower: 600ms;

  /* ============================================
     Z-INDEX TOKENS (Full Scale)
     ============================================ */
  --z-negative: -1;
  --z-base: 0;
  --z-raised: 1;
  --z-dropdown: 10;
  --z-sticky: 100;
  --z-fixed: 200;
  --z-overlay: 300;
  --z-modal: 400;
  --z-popover: 500;
  --z-tooltip: 600;
  --z-toast: 700;
  --z-max: 9999;

  /* ============================================
     EXTENDED SHADOWS
     ============================================ */
  --shadow-xs: 0 1px 2px rgba(15, 27, 46, 0.16);
  --shadow-2xl: 0 24px 48px rgba(15, 27, 46, 0.38);
  --shadow-inner: inset 0 2px 4px rgba(15, 27, 46, 0.14);
  --shadow-glow: none;
  --shadow-vignette: inset 0 0 100px rgba(8, 14, 26, 0.45);

  /* ============================================
     EXTENDED TRANSITIONS
     ============================================ */
  --duration-instant: 0ms;
  --duration-slowest: 800ms;
  --ease-linear: linear;
  --ease-smooth: cubic-bezier(0.25, 0.1, 0.25, 1);

  /* ============================================
     ACCENT COLOR VARIANTS (Dark-mode lifted)
     ============================================ */
  --color-burgundy-light: #c56a6a;
  --color-olive-light: #9fbe79;
  --color-shalom-light: #79c8d6;

  /* ============================================
     BASELINE GRID (Typography Craft)
     ============================================ */
  --baseline: 8px;

  /* ============================================
     COMPONENT TOKENS
     ============================================ */
  --nav-height: 64px;
  --nav-height-mobile: 56px;
}

/* ============================================
   FONT FAMILY VARIABLES
   Must be outside @theme because they use var() refs
   to runtime CSS variables set on <html>.
   @theme compiles at build time and can't resolve them.
   ============================================ */
:root {
  --font-instrument-serif:
    'Instrument Serif', Georgia, 'Times New Roman', serif;
  --font-industry:
    'Industry', 'Avenir Next Condensed', 'Arial Narrow', 'Segoe UI', sans-serif;
  --font-space-grotesk:
    'Space Grotesk', 'Avenir Next', 'Segoe UI', 'Helvetica Neue', sans-serif;
  --font-family: var(
    --font-instrument-serif,
    'Instrument Serif',
    Georgia,
    serif
  );

  --font-family-display: var(--font-family);
  --font-family-body: var(--font-family);
  --font-family-serif: var(--font-family);
  --font-family-ui: var(--font-industry);
}

/* ============================================
   LIGHT MODE OVERRIDES
   ============================================ */
:root:not(.dark) {
  --color-bg: #fffdf8;
  --color-fg: #121d30;
  --color-text-primary: #121d30;
  --color-text-secondary: rgba(18, 29, 48, 0.76);
  --color-text-tertiary: rgba(18, 29, 48, 0.58);
  --color-text-muted: rgba(18, 29, 48, 0.44);
  --color-border: rgba(18, 29, 48, 0.14);
  --color-border-strong: rgba(18, 29, 48, 0.24);
  --color-surface: rgba(226, 177, 91, 0.08);
  --color-surface-raised: rgba(77, 159, 176, 0.1);
  --color-overlay: rgba(255, 253, 248, 0.84);
  --color-hover: rgba(18, 29, 48, 0.06);
  --color-active: rgba(18, 29, 48, 0.12);
}

@layer base {
  html {
    font-size: clamp(15px, 1vw + 14px, 17px);
    background-color: var(--color-bg);
    color: var(--color-text-primary);
    width: 100%;
    overflow-x: hidden;
    transition:
      background-color 400ms cubic-bezier(0.4, 0, 0.2, 1),
      color 400ms cubic-bezier(0.4, 0, 0.2, 1);
  }

  body {
    font-family: var(--font-family-serif);
    background-color: var(--color-bg);
    color: var(--color-text-primary);
    width: 100%;
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    letter-spacing: var(--tracking-tight);
  }

  /* Reduced motion: simple fades or instant */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  /* Focus states — gold ring with 3px shadow */
  button:focus-visible,
  a:focus-visible,
  input:focus-visible,
  textarea:focus-visible,
  [tabindex]:focus-visible {
    outline: 2px solid var(--color-gold);
    outline-offset: 2px;
    box-shadow: var(--shadow-focus);
  }

  /* Skip to content */
  .skip-to-content {
    position: absolute;
    left: -9999px;
    z-index: var(--z-max);
    padding: 1rem 2rem;
    background-color: var(--color-gold);
    color: var(--color-tehom);
    text-decoration: none;
    font-weight: 600;
  }
  .skip-to-content:focus {
    left: 50%;
    top: 1rem;
    transform: translateX(-50%);
  }

  /* Dark mode class — theme transition */
  .dark {
    --color-bg: #0b1420;
    --color-fg: #e9eef5;
    --color-gold: #c8a56a;
    --color-text-primary: #e9eef5;
    --color-text-secondary: rgba(233, 238, 245, 0.82);
    --color-text-tertiary: rgba(233, 238, 245, 0.68);
    --color-text-muted: rgba(233, 238, 245, 0.52);
    --color-border: rgba(233, 238, 245, 0.2);
    --color-border-strong: rgba(233, 238, 245, 0.36);
    --color-surface: rgba(233, 238, 245, 0.04);
    --color-surface-raised: rgba(15, 27, 42, 0.92);
    --color-overlay: rgba(6, 12, 19, 0.9);
    --color-hover: rgba(233, 238, 245, 0.08);
    --color-active: rgba(233, 238, 245, 0.13);
    --shadow-focus: 0 0 0 2px rgba(200, 165, 106, 0.55);
  }

  /* Ensure logos don't get inverted */
  img[src*='/logos/'],
  img[alt*='logo'],
  img[alt*='Logo'] {
    filter: none !important;
    mix-blend-mode: normal !important;
  }

  /* High contrast mode */
  @media (prefers-contrast: high) {
    .dark {
      --color-text-secondary: rgba(247, 243, 237, 0.85);
      --color-text-tertiary: rgba(247, 243, 237, 0.75);
      --color-border: rgba(247, 243, 237, 0.3);
      --color-border-strong: rgba(247, 243, 237, 0.5);
    }

    :root:not(.dark) {
      --color-text-secondary: rgba(26, 22, 18, 0.85);
      --color-text-tertiary: rgba(26, 22, 18, 0.75);
      --color-border: rgba(26, 22, 18, 0.3);
      --color-border-strong: rgba(26, 22, 18, 0.5);
    }
  }

  /* Forced colors mode (Windows High Contrast) */
  @media (forced-colors: active) {
    :root {
      --color-bg: Canvas;
      --color-fg: CanvasText;
      --color-text-primary: CanvasText;
      --color-gold: LinkText;
      --color-border: CanvasText;
    }
  }
}

/* ============================================
   GLOBAL NEWSPRINT SURFACE
   ============================================ */
.newsprint-site {
  background:
    repeating-linear-gradient(
      0deg,
      rgba(18, 29, 48, 0.02) 0,
      rgba(18, 29, 48, 0.02) 1px,
      transparent 1px,
      transparent 10px
    ),
    repeating-linear-gradient(
      90deg,
      rgba(18, 29, 48, 0.012) 0,
      rgba(18, 29, 48, 0.012) 1px,
      transparent 1px,
      transparent 8px
    ),
    var(--color-bg);
  overflow-x: hidden;
}

.dark .newsprint-site {
  background:
    repeating-linear-gradient(
      0deg,
      rgba(233, 238, 245, 0.028) 0,
      rgba(233, 238, 245, 0.028) 1px,
      transparent 1px,
      transparent 10px
    ),
    repeating-linear-gradient(
      90deg,
      rgba(200, 165, 106, 0.018) 0,
      rgba(200, 165, 106, 0.018) 1px,
      transparent 1px,
      transparent 8px
    ),
    var(--color-bg);
}

/* ============================================
   HOMEPAGE NEWSPAPER MODE
   ============================================ */
.newspaper-home {
  --color-bg: #fbf4e8;
  --color-fg: #19232f;
  --color-gold: #224f7d;
  --color-text-primary: #19232f;
  --color-text-secondary: rgba(25, 35, 47, 0.82);
  --color-text-tertiary: rgba(25, 35, 47, 0.66);
  --color-text-muted: rgba(25, 35, 47, 0.5);
  --color-border: rgba(25, 35, 47, 0.34);
  --color-border-strong: rgba(25, 35, 47, 0.5);
  --color-surface: rgba(25, 35, 47, 0.035);
  --color-surface-raised: rgba(255, 255, 255, 0.72);
  --color-overlay: rgba(251, 244, 232, 0.9);
  --color-hover: rgba(25, 35, 47, 0.06);
  --color-active: rgba(25, 35, 47, 0.1);
  --shadow-focus: 0 0 0 3px rgba(34, 79, 125, 0.3);
  position: relative;
  isolation: isolate;
  background:
    repeating-linear-gradient(
      0deg,
      rgba(25, 35, 47, 0.02) 0,
      rgba(25, 35, 47, 0.02) 1px,
      transparent 1px,
      transparent 10px
    ),
    repeating-linear-gradient(
      90deg,
      rgba(25, 35, 47, 0.012) 0,
      rgba(25, 35, 47, 0.012) 1px,
      transparent 1px,
      transparent 8px
    ),
    var(--color-bg);
  color: var(--color-text-primary);
}

.dark .newspaper-home {
  --color-bg: #0b1420;
  --color-fg: #e9eef5;
  --color-gold: #c8a56a;
  --color-text-primary: #e9eef5;
  --color-text-secondary: rgba(233, 238, 245, 0.84);
  --color-text-tertiary: rgba(233, 238, 245, 0.68);
  --color-text-muted: rgba(233, 238, 245, 0.52);
  --color-border: rgba(233, 238, 245, 0.2);
  --color-border-strong: rgba(233, 238, 245, 0.36);
  --color-surface: rgba(233, 238, 245, 0.03);
  --color-surface-raised: rgba(15, 27, 42, 0.9);
  --color-overlay: rgba(7, 12, 20, 0.9);
  --color-hover: rgba(233, 238, 245, 0.08);
  --color-active: rgba(233, 238, 245, 0.13);
  --shadow-focus: 0 0 0 2px rgba(200, 165, 106, 0.55);
}

.newspaper-reading {
  --color-bg: #f9f3e7;
  --color-fg: #1a2639;
  --color-gold: #224f7d;
  --color-text-primary: #1a2639;
  --color-text-secondary: rgba(26, 38, 57, 0.82);
  --color-text-tertiary: rgba(26, 38, 57, 0.64);
  --color-text-muted: rgba(26, 38, 57, 0.52);
  --color-border: rgba(26, 38, 57, 0.34);
  --color-border-strong: rgba(26, 38, 57, 0.5);
  --color-surface: rgba(26, 38, 57, 0.035);
  --color-surface-raised: rgba(255, 255, 255, 0.76);
  --color-overlay: rgba(249, 243, 231, 0.9);
  --color-hover: rgba(26, 38, 57, 0.07);
  --color-active: rgba(26, 38, 57, 0.12);
  background:
    repeating-linear-gradient(
      0deg,
      rgba(26, 38, 57, 0.02) 0,
      rgba(26, 38, 57, 0.02) 1px,
      transparent 1px,
      transparent 10px
    ),
    repeating-linear-gradient(
      90deg,
      rgba(26, 38, 57, 0.014) 0,
      rgba(26, 38, 57, 0.014) 1px,
      transparent 1px,
      transparent 8px
    ),
    var(--color-bg);
}

.dark .newspaper-reading {
  --color-bg: #0b1420;
  --color-fg: #e9eef5;
  --color-gold: #c8a56a;
  --color-text-primary: #e9eef5;
  --color-text-secondary: rgba(233, 238, 245, 0.84);
  --color-text-tertiary: rgba(233, 238, 245, 0.68);
  --color-text-muted: rgba(233, 238, 245, 0.52);
  --color-border: rgba(233, 238, 245, 0.2);
  --color-border-strong: rgba(233, 238, 245, 0.36);
  --color-surface: rgba(233, 238, 245, 0.03);
  --color-surface-raised: rgba(15, 27, 42, 0.9);
  --color-overlay: rgba(7, 12, 20, 0.9);
  --color-hover: rgba(233, 238, 245, 0.08);
  --color-active: rgba(233, 238, 245, 0.13);
  --shadow-focus: 0 0 0 2px rgba(200, 165, 106, 0.55);
}

.newspaper-home::before {
  content: '';
  position: fixed;
  inset: 0;
  z-index: -1;
  pointer-events: none;
  opacity: 0.18;
  background: repeating-linear-gradient(
    14deg,
    rgba(18, 29, 48, 0.05) 0,
    rgba(18, 29, 48, 0.05) 1px,
    transparent 1px,
    transparent 12px
  );
  mix-blend-mode: multiply;
}

.newspaper-home::after {
  content: '';
  position: fixed;
  inset: 0;
  z-index: -1;
  pointer-events: none;
  opacity: 0.14;
  background: repeating-linear-gradient(
    -14deg,
    rgba(18, 29, 48, 0.035) 0,
    rgba(18, 29, 48, 0.035) 1px,
    transparent 1px,
    transparent 11px
  );
  mix-blend-mode: multiply;
}

.dark .newspaper-home::before {
  opacity: 0.2;
  mix-blend-mode: normal;
}

.dark .newspaper-home::after {
  opacity: 0.12;
  mix-blend-mode: normal;
}

.newspaper-home > * {
  position: relative;
  z-index: 1;
}

.newspaper-home .text-gold {
  color: var(--color-gold) !important;
}

.section-rule {
  border-bottom: 2px solid var(--color-border-strong) !important;
}

.newspaper-rule {
  border-top: 1px solid var(--color-border);
}

.newspaper-subrule {
  border-top: 2px solid var(--color-border-strong);
  border-bottom: 2px solid var(--color-border-strong);
}

.newspaper-card {
  background:
    repeating-linear-gradient(
      6deg,
      rgba(25, 35, 47, 0.018) 0,
      rgba(25, 35, 47, 0.018) 1px,
      transparent 1px,
      transparent 8px
    ),
    var(--color-surface-raised);
  border: 1px solid var(--color-border);
  box-shadow: none;
}

.dark .newspaper-card {
  background:
    repeating-linear-gradient(
      6deg,
      rgba(233, 238, 245, 0.022) 0,
      rgba(233, 238, 245, 0.022) 1px,
      transparent 1px,
      transparent 8px
    ),
    var(--color-surface-raised);
  border: 1px solid var(--color-border);
  box-shadow: none;
}

.home-meta-rail {
  position: -webkit-sticky;
  position: sticky;
  top: 0;
  width: 100%;
  z-index: var(--z-max);
  pointer-events: auto;
  background-color: color-mix(in srgb, var(--color-bg) 96%, transparent);
  backdrop-filter: none;
  box-shadow: none;
  border-bottom: 2px solid var(--color-border-strong);
}

.home-meta-nav::-webkit-scrollbar {
  display: none;
}

.home-meta-nav {
  scrollbar-width: none;
  pointer-events: auto;
}

.home-meta-rail a,
.home-rail-theme {
  position: relative;
  z-index: 1;
  pointer-events: auto;
}

.home-nav-rail {
  transform-origin: top center;
}

.masthead-fullwidth {
  display: flex;
  width: 100%;
  justify-content: space-between;
  align-items: baseline;
  gap: 0.1em;
}

.masthead-fullwidth > span {
  display: inline-block;
  flex: 0 0 auto;
}

.newspaper-flow-list,
.newspaper-faq-list {
  border-top: 2px solid var(--color-border-strong);
}

.newspaper-flow-item,
.newspaper-faq-item {
  border-bottom: 1px solid var(--color-border);
}

.newspaper-reading-main {
  border-top: 2px solid var(--color-border-strong);
}

@media (min-width: 1024px) {
  .newspaper-reading .reading-flow {
    padding-inline: 2.5rem;
    border-left: 2px solid var(--color-border-strong);
    border-right: 2px solid var(--color-border-strong);
  }
}

.illustration-frame {
  display: grid;
  gap: 0.55rem;
}

.illustration-plate {
  position: relative;
  overflow: hidden;
  border: 2px solid var(--color-border-strong);
  background-color: color-mix(in srgb, var(--color-bg) 82%, white 18%);
  isolation: isolate;
}

.illustration-plate::before {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: repeating-linear-gradient(
    45deg,
    rgba(25, 35, 47, 0.08) 0,
    rgba(25, 35, 47, 0.08) 1px,
    transparent 1px,
    transparent 7px
  );
  mix-blend-mode: multiply;
  opacity: 0.22;
  z-index: 2;
}

.dark .illustration-plate::before {
  background: repeating-linear-gradient(
    45deg,
    rgba(233, 238, 245, 0.09) 0,
    rgba(233, 238, 245, 0.09) 1px,
    transparent 1px,
    transparent 7px
  );
  mix-blend-mode: normal;
  opacity: 0.18;
}

.illustration-plate > img,
.illustration-plate > span,
.illustration-plate > div {
  position: absolute;
  inset: 0;
}

.illustration-placeholder {
  background:
    linear-gradient(
      130deg,
      color-mix(in srgb, var(--color-gold) 20%, transparent),
      transparent
    ),
    color-mix(in srgb, var(--color-bg) 88%, white 12%);
}

.illustration-wordblock {
  position: absolute;
  left: 0.7rem;
  bottom: 0.65rem;
  z-index: 3;
  background: color-mix(in srgb, var(--color-bg) 86%, transparent);
  border: 1px solid var(--color-border-strong);
  padding: 0.2rem 0.42rem;
  letter-spacing: 0.09em;
}

.effect-woodblock {
  filter: contrast(1.08) grayscale(0.12) saturate(0.85);
}

.effect-halftone {
  background-image: radial-gradient(
    circle,
    color-mix(in srgb, var(--color-text-primary) 26%, transparent) 1px,
    transparent 1px
  );
  background-size: 6px 6px;
}

.effect-dither {
  image-rendering: pixelated;
  filter: contrast(1.12) saturate(0.78);
}

.effect-ink {
  filter: contrast(1.05) saturate(0.86);
}

.wordblock-panel {
  border: 1px solid var(--color-border);
  background: color-mix(in srgb, var(--color-surface-raised) 84%, transparent);
  padding: 1.15rem;
}

.faq-hover-card {
  border: 1px solid var(--color-border);
  background: color-mix(in srgb, var(--color-surface-raised) 90%, transparent);
  min-height: 220px;
  transition:
    border-color var(--duration-base) var(--ease-out),
    transform var(--duration-base) var(--ease-out);
}

.faq-hover-trigger {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 0.7rem;
  width: 100%;
  height: 100%;
  text-align: left;
  padding: 1rem;
}

.faq-hover-card:hover,
.faq-hover-card:focus-within,
.faq-hover-card.is-open {
  border-color: var(--color-border-strong);
}

.faq-hover-card .faq-answer {
  max-height: 0;
  overflow: hidden;
  opacity: 0;
  transform: translateY(6px);
  transition:
    opacity var(--duration-base) var(--ease-out),
    transform var(--duration-base) var(--ease-out),
    max-height var(--duration-base) var(--ease-out);
}

.faq-hover-card:hover .faq-answer,
.faq-hover-card:focus-within .faq-answer,
.faq-hover-card.is-open .faq-answer {
  max-height: 220px;
  opacity: 1;
  transform: translateY(0);
}

.print-rail {
  position: relative;
}

.print-rail-controls {
  position: absolute;
  top: -2.8rem;
  right: 0;
  display: flex;
  gap: 0.45rem;
  z-index: 2;
}

.print-rail-control {
  min-width: 38px;
  min-height: 38px;
  border: 1px solid var(--color-border-strong);
  background: color-mix(in srgb, var(--color-bg) 92%, transparent);
  font-family: var(--font-family-ui);
  font-size: 1rem;
  line-height: 1;
  transition:
    background-color var(--duration-base) var(--ease-out),
    border-color var(--duration-base) var(--ease-out);
}

.print-rail-control:hover,
.print-rail-control:focus-visible {
  border-color: var(--color-gold);
  background-color: color-mix(in srgb, var(--color-gold) 10%, var(--color-bg));
}

.print-rail-viewport {
  display: grid;
  grid-auto-flow: column;
  grid-auto-columns: minmax(270px, 1fr);
  gap: 1rem;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  padding: 0.25rem 0.15rem 0.8rem;
  scrollbar-width: thin;
}

.print-rail-item {
  scroll-snap-align: center;
}

.print-rail-dots {
  display: flex;
  justify-content: center;
  gap: 0.45rem;
  margin-top: 0.45rem;
}

.print-rail-dot {
  width: 8px;
  height: 8px;
  border-radius: 999px;
  border: 1px solid var(--color-border-strong);
  background: transparent;
}

.print-rail-dot.is-active {
  background: var(--color-gold);
  border-color: var(--color-gold);
}

@media (min-width: 1024px) {
  .print-rail-viewport {
    grid-auto-columns: minmax(330px, 1fr);
  }
}

@layer utilities {
  /* ============================================
     TYPOGRAPHY UTILITIES
     ============================================ */

  /* Masthead: EUANGELION wordmark only */
  .text-masthead {
    font-family: var(--font-family-serif) !important;
    text-transform: uppercase;
    letter-spacing: 0.2em;
    font-weight: 400;
  }

  /* Display: hero titles, large headings */
  .text-display {
    font-family: var(--font-family-serif);
    font-weight: 700;
    letter-spacing: -0.02em;
    line-height: 1.1;
  }

  /* Label: small caps UI text */
  .text-label {
    font-family: var(--font-family-ui);
    text-transform: uppercase;
    letter-spacing: 0.12em;
    font-weight: 600;
  }

  /* Serif italic: intro text, teasers */
  .text-serif-italic {
    font-family: var(--font-family-serif) !important;
    font-style: italic;
    line-height: 1.6;
  }

  /* Nav: menu items */
  .text-nav {
    font-family: var(--font-family-ui) !important;
    font-size: 1.45rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }

  /* ============================================
     FLUID TYPOGRAPHY
     ============================================ */
  .vw-heading-xl {
    font-size: clamp(3rem, 7vw, 6rem);
    line-height: 1;
  }
  .vw-heading-lg {
    font-size: clamp(2.25rem, 5vw, 4.5rem);
    line-height: 1.1;
  }
  .vw-heading-md {
    font-size: clamp(1.875rem, 3.25vw, 3.25rem);
    line-height: 1.15;
  }
  .vw-body-lg {
    font-size: clamp(1.25rem, 1.95vw, 1.75rem);
    line-height: 1.62;
    max-width: 680px;
  }
  .vw-body {
    font-size: clamp(1.125rem, 1.55vw, 1.5rem);
    line-height: 1.62;
    max-width: 680px;
  }
  .vw-small {
    font-size: clamp(0.95rem, 1.1vw, 1.2rem);
    line-height: 1.45;
  }

  /* Day number: architectural display (120-160px) */
  .text-day-number {
    font-family: var(--font-family-serif);
    font-size: clamp(3.75rem, 10vw, 10rem);
    font-weight: 100;
    line-height: 1;
    letter-spacing: -0.02em;
  }

  /* (Old observe-fade / gentle-rise / stagger classes removed — replaced by GSAP FadeIn + StaggerGrid components) */

  /* ============================================
     SCROLL PROGRESS
     ============================================ */
  .scroll-progress {
    position: fixed;
    top: 0;
    left: 0;
    height: 3px;
    background: var(--color-gold);
    transform-origin: left;
    z-index: var(--z-sticky);
    transition:
      transform 100ms cubic-bezier(0, 0, 0.2, 1),
      opacity 300ms cubic-bezier(0, 0, 0.2, 1);
  }

  /* ============================================
     SCRIPTURE BLOCK TREATMENT
     ============================================ */
  .scripture-block {
    border-left: 3px solid var(--color-gold);
    padding-left: 1.5rem;
    padding-top: 0.75rem;
    padding-bottom: 0.75rem;
    background: color-mix(in srgb, var(--color-gold) 12%, transparent);
    font-family: var(--font-family-serif) !important;
    font-style: italic;
    line-height: 1.75;
  }

  /* ============================================
     PULL QUOTE
     ============================================ */
  .pull-quote {
    font-family: var(--font-family-serif);
    font-size: clamp(1.75rem, 3vw, 2.5rem);
    font-weight: 700;
    line-height: 1.3;
  }

  /* ============================================
     MODULE LAYOUT UTILITIES
     ============================================ */

  /* Gold left-accent strip (insight, bridge, scripture fallback) */
  .module-accent {
    border-left: 3px solid var(--color-gold);
    padding-left: 1.5rem;
  }

  /* Callout block: gold-tinted background + left border */
  .module-callout {
    border-left: 3px solid var(--color-gold);
    padding: 1.5rem;
    background: color-mix(in srgb, var(--color-gold) 12%, transparent);
  }

  /* Card surface: raised bg + border */
  .module-card {
    background-color: var(--color-surface-raised);
    border: 1px solid var(--color-border);
  }

  /* Surface card: lighter bg + border */
  .module-surface {
    background-color: var(--color-surface);
    border: 1px solid var(--color-border);
  }

  /* Gold-bordered card (takeaway) */
  .module-card-gold {
    background-color: var(--color-surface-raised);
    border: 1px solid var(--color-gold);
  }

  /* Sub-section label (inside modules) */
  .module-sublabel {
    font-family: var(--font-family-ui);
    text-transform: uppercase;
    letter-spacing: 0.12em;
    font-weight: 600;
    font-size: clamp(0.75rem, 0.85vw, 0.9375rem);
    line-height: 1.5;
    color: var(--color-text-muted);
  }

  /* ============================================
     COLOR UTILITIES
     ============================================ */
  .text-gold {
    color: var(--color-gold);
  }
  .text-scroll {
    color: var(--color-scroll);
  }
  .text-tehom {
    color: var(--color-tehom);
  }
  .bg-tehom {
    background-color: var(--color-tehom);
  }
  .bg-scroll {
    background-color: var(--color-scroll);
  }
  .bg-gold {
    background-color: var(--color-gold);
  }
  .border-gold {
    border-color: var(--color-gold);
  }

  /* Semantic utilities */
  .bg-page {
    background-color: var(--color-bg);
  }
  .text-page {
    color: var(--color-text-primary);
  }
  .text-secondary {
    color: var(--color-text-secondary);
  }
  .text-tertiary {
    color: var(--color-text-tertiary);
  }
  .text-muted {
    color: var(--color-text-muted);
  }
  .border-subtle {
    border-color: var(--color-border);
  }
  .border-strong {
    border-color: var(--color-border-strong);
  }
  .bg-surface {
    background-color: var(--color-surface);
  }
  .bg-surface-raised {
    background-color: var(--color-surface-raised);
  }

  /* Ink emphasis: flat color, no glow/shimmer */
  .gold-shimmer {
    color: var(--color-gold);
    -webkit-text-fill-color: currentColor;
  }

  /* Ink accent as background */
  .gold-shimmer-bg {
    background: var(--color-gold);
  }

  /* ============================================
     ACCENT COLOR UTILITIES (Pathway colors)
     ============================================ */
  .accent-burgundy {
    color: var(--color-burgundy-light);
  }
  .accent-olive {
    color: var(--color-olive-light);
  }
  .accent-shalom {
    color: var(--color-shalom-light);
  }
  .bg-accent-burgundy {
    background-color: var(--color-burgundy);
  }
  .bg-accent-olive {
    background-color: var(--color-olive);
  }
  .bg-accent-shalom {
    background-color: var(--color-shalom);
  }

  :root:not(.dark) .accent-burgundy {
    color: var(--color-burgundy);
  }
  :root:not(.dark) .accent-olive {
    color: var(--color-olive);
  }
  :root:not(.dark) .accent-shalom {
    color: var(--color-shalom);
  }

  /* ============================================
     SEMANTIC TRANSITION UTILITIES
     ============================================ */
  .transition-theme {
    transition:
      color var(--duration-base) var(--ease-out),
      background-color var(--duration-base) var(--ease-out),
      border-color var(--duration-base) var(--ease-out);
  }
  .transition-opacity {
    transition: opacity var(--duration-base) var(--ease-out);
  }
  .transition-transform {
    transition: transform var(--duration-base) var(--ease-out);
  }
  .transition-shadow {
    transition: box-shadow var(--duration-base) var(--ease-out);
  }

  /* ============================================
     CARD LIFT — shadow on hover (uses shadow tokens!)
     ============================================ */
  .card-lift {
    transition:
      transform var(--duration-base) var(--ease-out),
      border-color var(--duration-base) var(--ease-out);
  }
  .card-lift:hover {
    transform: translateY(-1px);
    border-color: var(--color-border-strong);
  }

  /* ============================================
     ANIMATED UNDERLINE — gold, left-to-right
     ============================================ */
  .animated-underline {
    position: relative;
    display: inline-block;
    transition:
      transform var(--duration-base) var(--ease-out),
      color var(--duration-base) var(--ease-out);
  }
  .animated-underline::after {
    content: '';
    position: absolute;
    left: 0;
    bottom: -2px;
    width: 0;
    height: 1.5px;
    background-color: var(--color-gold);
    transition: width var(--duration-moderate) var(--ease-out);
  }
  .animated-underline:hover,
  .animated-underline:focus-visible {
    transform: translateY(-1px);
  }
  .animated-underline:hover::after,
  .animated-underline:focus-visible::after {
    width: 100%;
  }

  /* ============================================
     CTA SYSTEM — editorial interactions
     ============================================ */
  .cta-major {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    border: 1.5px solid var(--color-text-primary);
    background: transparent;
    color: var(--color-text-primary);
    text-transform: uppercase;
    letter-spacing: 0.12em;
    font-family: var(--font-family-ui);
    font-weight: 600;
    transition:
      transform var(--duration-base) var(--ease-out),
      color var(--duration-base) var(--ease-out),
      border-color var(--duration-base) var(--ease-out),
      text-shadow var(--duration-base) var(--ease-out);
  }
  .cta-major::before {
    content: '';
    position: absolute;
    inset: 0;
    pointer-events: none;
    background:
      linear-gradient(var(--color-gold), var(--color-gold)) left top / 0 1.5px
        no-repeat,
      linear-gradient(var(--color-gold), var(--color-gold)) right bottom / 0
        1.5px no-repeat,
      linear-gradient(var(--color-gold), var(--color-gold)) left bottom / 1.5px
        0 no-repeat,
      linear-gradient(var(--color-gold), var(--color-gold)) right top / 1.5px 0
        no-repeat;
    transition: background-size var(--duration-slow) var(--ease-out);
  }
  .cta-major:hover,
  .cta-major:focus-visible {
    transform: translate(-0.5px, -0.5px);
    text-shadow: 0.35px 0 0 var(--color-gold);
    border-color: var(--color-border-strong);
  }
  .cta-major:hover::before,
  .cta-major:focus-visible::before {
    background-size:
      100% 1.5px,
      100% 1.5px,
      1.5px 100%,
      1.5px 100%;
  }
  .cta-major:active {
    transform: none;
    text-shadow: none;
  }

  .link-highlight {
    position: relative;
    z-index: 0;
    display: inline-block;
    transition:
      transform var(--duration-base) var(--ease-out),
      color var(--duration-base) var(--ease-out);
  }
  .link-highlight::before {
    content: '';
    position: absolute;
    inset: 58% -0.1em 6% -0.1em;
    z-index: -1;
    background: color-mix(in srgb, var(--color-gold) 34%, transparent);
    transform: scaleX(0);
    transform-origin: left center;
    transition: transform var(--duration-base) var(--ease-out);
  }
  .link-highlight:hover,
  .link-highlight:focus-visible {
    transform: translateY(-1px);
  }
  .link-highlight:hover::before,
  .link-highlight:focus-visible::before {
    transform: scaleX(1);
  }

  .btn-hover {
    transition:
      transform var(--duration-fast) var(--ease-out),
      border-color var(--duration-fast) var(--ease-out);
  }
  .btn-hover:hover {
    transform: translateY(-1px);
    border-color: var(--color-border-strong);
  }
  .btn-hover:active {
    transform: none;
  }

  /* Prayer text: static, no pulsing glow */
  .breathe-prayer {
    animation: none;
    opacity: 1;
    transform: none;
  }

  /* Dot pattern background (paper.design inspired) */
  .dot-pattern {
    background-image: radial-gradient(
      circle,
      var(--color-text-muted) 0.5px,
      transparent 0.5px
    );
    background-size: 24px 24px;
  }

  .dot-pattern-lg {
    background-image: radial-gradient(
      circle,
      var(--color-text-muted) 0.75px,
      transparent 0.75px
    );
    background-size: 32px 32px;
  }

  /* ============================================
     SECTION BREATHING — generous editorial spacing
     ============================================ */
  .section-breathing {
    padding-top: 5rem;
    padding-bottom: 5rem;
  }
  @media (min-width: 768px) {
    .section-breathing {
      padding-top: 8rem;
      padding-bottom: 8rem;
    }
  }
  @media (min-width: 1024px) {
    .section-breathing {
      padding-top: 10rem;
      padding-bottom: 10rem;
    }
  }

  /* ============================================
     SCROLL INDICATOR — animated down-chevron
     ============================================ */
  .scroll-indicator {
    animation: scrollBounce 2s ease-in-out infinite;
  }

  @keyframes scrollBounce {
    0%,
    100% {
      transform: translateY(0);
      opacity: 0.6;
    }
    50% {
      transform: translateY(8px);
      opacity: 1;
    }
  }

  /* ============================================
     READING FLOW — continuous article container
     ============================================ */
  .reading-flow {
    width: min(100%, 980px);
    margin-left: auto;
    margin-right: auto;
  }

  .newspaper-reading .type-prose {
    font-size: clamp(1.18rem, 1.12vw + 0.9rem, 1.46rem);
    line-height: 1.8;
  }

  .newspaper-reading .type-prose p,
  .newspaper-reading .vw-body,
  .newspaper-reading .vw-body-lg {
    max-width: 74ch;
  }

  .newspaper-reading .reading-flow > * {
    width: 100%;
    max-width: 860px;
    margin-left: auto;
    margin-right: auto;
  }

  /* ============================================
     PROSE-LEGAL — legal document styling
     ============================================ */
  .prose-legal {
    max-width: 680px;
  }
  .prose-legal h1 {
    font-family: var(--font-family-serif);
    font-size: clamp(2rem, 4vw, 3rem);
    font-weight: 700;
    letter-spacing: -0.02em;
    line-height: 1.1;
    margin-bottom: 1.5rem;
    color: var(--color-text-primary);
  }
  .prose-legal h2 {
    font-family: var(--font-family-serif);
    font-size: clamp(1.25rem, 2vw, 1.75rem);
    font-weight: 600;
    letter-spacing: -0.01em;
    line-height: 1.3;
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    color: var(--color-text-primary);
  }
  .prose-legal h3 {
    font-family: var(--font-family-serif);
    font-size: clamp(1rem, 1.5vw, 1.25rem);
    font-weight: 600;
    margin-top: 2rem;
    margin-bottom: 0.75rem;
    color: var(--color-text-primary);
  }
  .prose-legal p {
    font-size: clamp(1rem, 1.2vw, 1.125rem);
    line-height: 1.7;
    margin-bottom: 1.25rem;
    color: var(--color-text-secondary);
  }
  .prose-legal ul,
  .prose-legal ol {
    margin-bottom: 1.25rem;
    padding-left: 1.5rem;
    color: var(--color-text-secondary);
  }
  .prose-legal li {
    font-size: clamp(1rem, 1.2vw, 1.125rem);
    line-height: 1.7;
    margin-bottom: 0.5rem;
  }
  .prose-legal strong {
    color: var(--color-text-primary);
    font-weight: 600;
  }
  .prose-legal a {
    color: var(--color-gold);
    text-decoration: underline;
    text-underline-offset: 2px;
  }
  .prose-legal a:hover {
    color: var(--color-text-primary);
  }

  /* (Old landing-reveal classes removed — replaced by GSAP FadeIn components) */

  /* ============================================
     LENIS SMOOTH SCROLL
     ============================================ */
  html.lenis,
  html.lenis body {
    height: auto;
  }

  .lenis.lenis-smooth {
    scroll-behavior: auto !important;
  }

  .lenis.lenis-smooth [data-lenis-prevent] {
    overscroll-behavior: contain;
  }

  .lenis.lenis-stopped {
    overflow: hidden;
  }

  .lenis.lenis-scrolling {
    /* Placeholder for scroll-in-progress state */
  }

  /* ============================================
     MOTION UTILITIES
     ============================================ */

  /* Will-change hints — apply during animation, remove after */
  .will-change-transform {
    will-change: transform;
  }
  .will-change-opacity {
    will-change: opacity;
  }

  /* GPU-accelerated layer */
  .gpu {
    transform: translateZ(0);
    backface-visibility: hidden;
  }

  /* ============================================
     MIXED HEADLINE SYSTEM (Emphasis-based)
     ============================================ */
  .headline-sans {
    font-family: var(--font-family-serif);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: -0.02em;
  }
  .headline-serif {
    font-family: var(--font-family-serif) !important;
    font-style: italic;
    font-weight: 400;
    text-transform: none;
    letter-spacing: 0.01em;
  }
  .headline-mixed {
    display: flex;
    flex-wrap: wrap;
    align-items: baseline;
    gap: 0.15em;
  }

  /* ============================================
     SACRED ILLUMINATION SCALE
     ============================================ */

  /* Mega: hero wordmarks, massive display */
  .type-mega {
    font-size: clamp(4rem, 12vw, 10rem);
    font-family: var(--font-family-serif) !important;
    font-weight: 400;
    line-height: 0.85;
    letter-spacing: -0.02em;
  }

  /* Micro: smallest labels, superscripts */
  .type-micro {
    font-size: clamp(0.72rem, 0.82vw, 0.86rem);
    font-family: var(--font-family-ui);
    letter-spacing: 0.13em;
    text-transform: uppercase;
    font-weight: 600;
  }

  /* Ornamental day number: massive, behind title, gold ghost */
  .type-day-ornament {
    font-family: var(--font-family-serif) !important;
    font-size: clamp(6rem, 18vw, 14rem);
    font-weight: 400;
    line-height: 0.7;
    color: var(--color-gold);
    opacity: 0.08;
    position: absolute;
    pointer-events: none;
    user-select: none;
  }

  /* Old-style numerals utility */
  .oldstyle-nums {
    font-variant-numeric: oldstyle-nums proportional-nums;
  }

  /* ============================================
     ORNAMENTAL DIVIDERS
     ============================================ */
  .ornament-divider {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    margin: 3rem auto;
    max-width: 200px;
  }
  .ornament-divider::before,
  .ornament-divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--color-gold);
    opacity: 0.2;
  }
  .ornament-divider .ornament {
    color: var(--color-gold);
    opacity: 0.3;
    font-size: 0.75rem;
  }
}

/* ============================================
   PRINT STYLESHEET
   ============================================ */
@media print {
  @page {
    margin: 2cm;
    size: A4;
  }

  /* Force light mode */
  :root,
  .dark {
    --color-bg: #ffffff !important;
    --color-fg: #000000 !important;
    --color-text-primary: #000000 !important;
    --color-text-secondary: #333333 !important;
    --color-text-tertiary: #666666 !important;
    --color-text-muted: #999999 !important;
    --color-border: #cccccc !important;
    --color-surface: #f5f5f5 !important;
    --color-surface-raised: #eeeeee !important;
    --color-gold: #8b6914 !important;
  }

  body {
    background: white !important;
    color: black !important;
    font-size: 12pt !important;
  }

  /* Branding header for print */
  body::before {
    content: 'EUANGELION';
    display: block;
    font-family: var(--font-family-serif);
    font-size: 10pt;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: #8b6914;
    padding-bottom: 0.5cm;
    margin-bottom: 0.5cm;
    border-bottom: 0.5pt solid #cccccc;
  }

  /* Hide navigation, scroll progress, buttons, interactive elements, chat FAB */
  nav,
  .scroll-progress,
  .skip-to-content,
  button,
  .scroll-indicator,
  footer,
  [role='dialog'],
  [aria-label='Open biblical research chat'] {
    display: none !important;
  }

  /* Show all animated elements in final state */
  [style*='opacity: 0'],
  [data-gsap] {
    opacity: 1 !important;
    transform: none !important;
  }

  /* Clean up layout */
  .min-h-screen {
    min-height: auto !important;
  }

  /* Scripture: constrain fullbleed to reading width */
  .scripture-block {
    border-left: 2pt solid #8b6914 !important;
    background: #f9f9f9 !important;
    max-width: 100% !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
  }

  /* Page breaks */
  h1,
  h2,
  h3 {
    page-break-after: avoid;
  }

  [class*='mb-24'],
  [class*='mb-40'] {
    page-break-inside: avoid;
  }

  /* Module sections: avoid breaking inside */
  .reading-flow > * {
    page-break-inside: avoid;
  }

  /* Links: show URL */
  a[href]::after {
    content: ' (' attr(href) ')';
    font-size: 0.8em;
    color: #666;
  }

  a[href^='/']::after,
  a[href^='#']::after {
    content: '';
  }

  /* Legal pages: clean print */
  .prose-legal {
    max-width: 100% !important;
  }
}
